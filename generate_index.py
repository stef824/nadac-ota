import os

# --- é…ç½®åŒº ---
# æ’é™¤ä¸éœ€è¦æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šçš„æ–‡ä»¶å¤¹ï¼ˆå¦‚ Git é…ç½®æ–‡ä»¶æˆ–è„šæœ¬æœ¬èº«ï¼‰
EXCLUDE_DIRS = {'.git', '.github', 'assets', 'css', 'js', '__pycache__'}
# é¡µé¢æ ‡é¢˜
PAGE_TITLE = "æ–‡ä»¶å­˜å‚¨åº“ç´¢å¼•"

def generate_html():
    # 1. è·å–å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å¤¹ï¼Œå¹¶è¿‡æ»¤æ‰æ’é™¤åå•
    try:
        dirs = [d for d in os.listdir('.') if os.path.isdir(d) and d not in EXCLUDE_DIRS]
        dirs.sort()  # æŒ‰å­—æ¯é¡ºåºæ’åº
    except Exception as e:
        print(f"è¯»å–ç›®å½•å¤±è´¥: {e}")
        return

    # 2. æ„å»º HTML å†…å®¹
    # ä½¿ç”¨äº†ç®€å•çš„ CSS è®©é¡µé¢åœ¨æ‰‹æœºå’Œç”µè„‘ä¸Šçœ‹èµ·æ¥éƒ½æ¯”è¾ƒèˆ’æœ
    html_content = f"""<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{PAGE_TITLE}</title>
    <style>
        body {{ font-family: -apple-system, sans-serif; line-height: 1.6; padding: 20px; background-color: #f6f8fa; color: #24292f; }}
        .container {{ max-width: 800px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 8px; border: 1px solid #d0d7de; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }}
        h1 {{ font-size: 24px; border-bottom: 1px solid #d0d7de; padding-bottom: 10px; margin-top: 0; }}
        ul {{ list-style: none; padding: 0; }}
        li {{ border-bottom: 1px solid #ebf0f4; }}
        li:last-child {{ border-bottom: none; }}
        a {{ display: block; padding: 12px 10px; text-decoration: none; color: #0969da; font-weight: 500; transition: 0.2s; }}
        a:hover {{ background-color: #f3f4f6; color: #0a4a91; }}
        .icon {{ margin-right: 10px; font-size: 1.1em; }}
        .footer {{ margin-top: 20px; font-size: 12px; color: #57606a; text-align: center; }}
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ {PAGE_TITLE}</h1>
        <ul>
            {"".join([f'<li><a href="./{d}/"><span class="icon">ğŸ“‚</span>{d}/</a></li>' for d in dirs])}
        </ul>
        <div class="footer">Auto Generated By Py</div>
    </div>
</body>
</html>"""

    # 3. å†™å…¥ index.html æ–‡ä»¶
    try:
        with open('index.html', 'w', encoding='utf-8') as f:
            f.write(html_content)
        print("âœ¨ Success! index.html updated, {} folders in total.".format(len(dirs)))
    except Exception as e:
        print(f"Failed to write file: {e}")

if __name__ == "__main__":
    generate_html()
